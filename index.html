<!DOCTYPE html>
<!-- saved from url=(0065)http://html5slides.googlecode.com/svn/trunk/template/index.html#1 -->
<html>
<head>
    <title>"The Website's Slow" - Tips and Tools for Identifying Performance Bottlenecks</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <link href='http://fonts.googleapis.com/css?family=Roboto+Condensed' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Arizonia' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="reveal/reset.css">

    <link rel="stylesheet" href="reveal/custom.css">
    <link rel="stylesheet" href="reveal/heart.css">
    <link rel="stylesheet" href="reveal/print.css" type="text/css" media="print">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script> 
</head>
<body>
<div class="reveal linear">

<!-- Used to fade in a background when a specific slide state is reached -->
<div class="state-background"></div>

<!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">

<section>
    <h1>
      "The Website's Slow"
    </h1>
    <p style="color: white;">
      Tips and Tools for Identifying Performance Bottlenecks
    </p>
</section>

<section class="center-slide">
  <h1>Who I am</h1>
  <p style="color: white;">
    And why you should listen to me
  </p>
  <!-- 
      They say when you give a talk, you should let the audience know your qualifications.
    -->
</section>
  
<section>
    <h3>My name is Sammy Larbi</h3>
    <div class="fragment subsection">
      <h3>I'm a freelance Ruby developer</h3>
    </div>
    <div class="fragment subsection">
      <h3>6 years playing with Rails</h3>
      <!-- Until I recently looked it up, apparently I've had 4 for the last 3 -->
    </div>
    <div class="fragment subsection">
      <h3>4 projects recently needed P.E.D.</h3>
    </div>
    <div class="fragment subsection">
      (Performance Enhancing Development)
    </div>
</section>

<section>
  <h1>
    "The Website's Slow"
  </h1>
</section>

<section>
  <img src="images/slow.png" height="500" alt="The customer tells you 'The website is slow'"/>
  <!-- from iphonetextgenerator.com -->
</section>

<section>
  <img src="images/link.png" height="500" alt="You respond, asking which webpage"/>
</section>

<section class="center-slide">
  <h1>Isolated Actions</h1>
  <!-- The easy stuff -->
</section>

<section>
  <img src="images/nplus1.png" alt="n+1 queries in an action" width="900"/>
</section>

<section>
  <img src="images/slowquery.png" alt="slow query in an action" width="900"/>
</section>

<section>
  <p style="color: white;">
  Or maybe your app resides on one network 
  and your DB on another, and you're doing
  </p>
  <h2>
  <code>select * from a_table</code>
  </h2> 
  <p style="color: white;">
    with 
    many records &amp; a ton of <h2 style="display: inline;">BLOB</h2> 
    <span style="color: white;">
      columns you have to transfer
    </span>
  </p>
</section>

<section class="center-slide">
  <h2>Measurement</h2>
  <!--
    In all of these easy cases, you're looking at Rails log files which contain measurements 
    of the time queries take to complete or views/partials take to render. In development
    mode, it's easy to reload a few times to get a baseline, make your changes, and reload
    a couple of times to see if there is improvement.
  -->
</section>

<section>
  <br/><br/>
  <h2>Data Anonymity</h2>
  <div class="fragment subsection">
    <h2>Visibility</h2>
  </div>
  <!-- 
    But rather than looking through the pollution of the entire log file, there are some tools 
    to help you make these problems and measurements more visible.
  --> 
</section>


<section>
  <h2 style="margin-bottom: 0;">rails-footnotes</h2>
  <img src="images/railsfootnotes.png" alt="Example of information rails-footnotes provides."/>
  <br/><br/>
  <div align="right">
    <small><a href="https://github.com/josevalim/rails-footnotes">rails-footnotes @ github</a></small>
  </div>
  <!--
    When I first moved to Rails, one of the things I missed most about ColdFusion was all the information
    they included at the bottom of the page for each request. Rails-footnotes gets me that information, 
    and includes which line of code in which file generated the query, which is helpful when you have
    one of a bunch of queries you need to optimize, and don't immediately know where to look.
  -->
</section>

<section>
  <h2 style="margin-bottom: 0;">bullet</h2>
  <img src="images/bulletnotification.png" alt="Example of information the bullet gem provides."/>
  <br/><br/>
  <div align="right">
    <small><a href="https://github.com/flyerhzm/bullet">bullet @ github</a></small>
  </div>
  <!--
    Bullet can notify us of N+1 query problem, unused eager loading, and the need for a counter cache.
    I've shown it logging in the javascript console, but it can also use a js alert, growl notification,
    or log to the Rails log file. 
  -->
</section>

<section>
  <h2>rack-insight</h2>
  <div align="right">
    <small><a href="https://github.com/pboling/rack-insight">rack-insight @ github</a></small>
  </div>
  <!-- 
    Works as a rack middleware with all kinds of cool options, but looks to need some more 
    work. I'd like to use it once I can spare enough time to contribute back to the project
  -->
</section>

<section class="center-slide">
  <h2>Granularity</h2>
</section>

<section>
  <h2 style="margin-bottom: 0;">ruby-prof</h2> 
  <img src="images/rubyprof-callstack.png" alt="Example of information ruby-prof provides in the call tree printer."/>
  <div align="right">
    <small><a href="https://github.com/rdp/ruby-prof">ruby-prof @ github</a></small>
    <small><a href="resources/ruby-prof/ruby-prof-call-tree.html" target="example">example</a></small>
  </div>
  <!-- 
    See the example for how to see where the call tree gets interesting
    There are a couple of ways to use it in your rails app
  -->
</section>

<section>
  <h2 style="margin-bottom: 0;">ruby-prof</h2>
  <h3>entire action</h3>
  <div class="code small">
    <code>
    gem 'ruby-prof', groups: [:development, :profile] # in Gemfile
    </code>
  </div>
  <div class="code small">
    <code>
      if Rails.env.profile? # in config.ru<br/>
      &nbsp;&nbsp;use Rack::RubyProf, :path => '/temp/profile'<br/>
      end
    </code>
  </div>
  <div class="code small">
    <code>
    # profile db connection settings in config/database.yml<br/>
    # (same as dev environment is fine)<br/>
    </code>
  </div>
  <div class="code small">
    <code>
    # bundle install and restart with: rails s -e profile<br/>
    </code>
  </div>
  <!-- 
    The docs mention you should create a profiling environment when you do this. I agree. The 
    standard ruby profiler is slow because it's pure ruby, and ruby prof is faster because it's 
    a C extension. But it's still slow, so you don't want to always have it running in development
    mode.
  -->
</section>


<section>
  <h2 style="margin-bottom: 0;">ruby-prof</h2>
  <h3>specific lines of code</h3>
  <div class="code">
    <code>
      require 'ruby-prof'<br/>
      <br/>
      result = RubyProf.profile do<br/>
      &nbsp;&nbsp;...<br/>
      &nbsp;&nbsp;[code to profile]<br/>
      &nbsp;&nbsp;...<br/>
      end<br/>
      <br/>
      printer=RubyProf::GraphPrinter.new(result)<br/>
      printer.print(STDOUT, {})<br/>
    </code>
  </div>
  
  <!-- 
  
  -->
</section>



<section>
  <h2>benchmark</h2>
  
  <div class="code">
    <code>
      require 'benchmark'<br/>
      puts Benchmark.measure { "a"*1_000_000 }
    </code>
  </div>
  
  <div align="right">
    <small><a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/benchmark/rdoc/Benchmark.html">benchmark docs</a></small>
  </div>
</section>

<section>
  http://en.wikibooks.org/wiki/Ruby_Programming/Standard_Library/Profiler
  profiling with ruby-prof https://github.com/rdp/ruby-prof 
  https://github.com/tmm1/perftools.rb -- where does it fit?
  <small>jruby has https://github.com/jruby/jruby/wiki/Profiling-jruby</small>
</section>

<section>
  (rails perf tests: benchmarking, profiling)  
  <div align="right">
    <small><a href="http://guides.rubyonrails.org/performance_testing.html">rails performance testing docs</a></small>
  </div>
</section>


<section>
  <img src="images/slow.png" height="500" alt="The customer tells you 'The website is slow'"/>
  <!-- from iphonetextgenerator.com -->
</section>

<section>
  <img src="images/link.png" height="500" alt="You respond, asking which webpage"/>
</section>

<section>
  <img src="images/everywhere.png" height="500" alt="The customer says 'everywhere'"/>
</section>


<section class="center-slide">
  <h1>Server Issues</h1>
</section>
<section class="center-slide">
  <h2>Memory Issues</h2>
</section>
<section>
  top - memory - threadsafe - puma
</section>

<section class="center-slide">
  <h2>CPU Issues</h2>
</section>
<section class="center-slide">
  how many processors do you have * average page load times => max throughput
</section>

<section class="center-slide">
  <h1>Holistic View</h1>
</section>

<section class="center-slide">
  rails log analyzer https://github.com/wvanbergen/request-log-analyzer
  new relic
  look at 
    rails metrics http://blog.plataformatec.com.br/2010/02/rails-metrics-know-what-is-happening-inside-your-rails-3-application/
    https://github.com/twinturbo/harness with https://github.com/etsy/statsd 
    harness could be external with stathat or librato
    or as engine to your rails app https://github.com/nearinfinity/system-metrics
</section>

<section>
  Does this stuff fit anywhere?
  h. does this fit anywhere? https://github.com/duncanbeevers/rails_view_annotator
  j. system level: http://auxesis.github.com/visage/ with collectd
  l. http://www.slideshare.net/goncalossilva/pdis2
</section>


<section>
  <h2>OMG Thanks!</h2>
  <br/>
  <ul style="-webkit-transform: rotate(20deg);">
    <li>Code:<br/><a href="https://github.com/codeodor">https://github.com/codeodor</a></li>
    <li>Blog:<br/><a href="http://www.codeodor.com">http://www.codeodor.com</a></li>
    <li>Tweet:<br/><a href="http://twitter.com/codeodor">@codeodor</a></li>
  </ul>
</section>


<!-- example slides -->
<section>
  <h2>Shiny happy people...</h2>
  <ul class="list">
    <li>holding hands,</li>
    <li>laughing,</li>
    <li>REM song</li>
  </ul>
</section>

<section class="center-slide">
  <h3>Something here</h3>
  <h3 class="fragment">for <strong>strong effect</strong></h3>
</section>


<section class="center-slide">
  <h2>Leads to</h2>
  <p>Howdy ho!</p>
</section>

<section>
  <blockquote>This is a long quote, wherein the speaker says something very profound.</blockquote>
  <cite>- Auturo de quota</cite>
</section>

<!-- end example slides -->



<div id="hearts"></div>
<script type="text/javascript">
  function moveHearts(){
    var numHearts = 4 + Math.random() * 3;

    $('#hearts').html("");
    for(var i=0; i < numHearts; i++)
      $('#hearts').append('<div class="heart" style="position: absolute;"></div>');
      
    $('.heart').each(function(index, heart){
      $(heart).css('top', Math.random() * 100 + '%');
      $(heart).css('left', Math.random() * 100 + '%');
      var degrees = -35 + Math.random() * 70;
      $(heart).css('transform', 'rotate(' + degrees + 'deg)');
    });
  }
  moveHearts();
</script>

</div>

<!-- The navigational controls UI -->
<aside class="controls">
  <a class="left" href="#">&#x25C4;</a>
  <a class="right" href="#">&#x25BA;</a>
  <a class="up" href="#">&#x25B2;</a>
  <a class="down" href="#">&#x25BC;</a>
</aside>

<!-- Presentation progress bar -->
<div class="progress"><span></span></div>

</div>
    <script src="libraries/head.min.js"></script>

    <script>
      // Scripts that should be loaded before initializing
      var scripts = [];

      // If the browser doesn't support classList, load a polyfill
      if( !document.body.classList ) {
        scripts.push( 'libraries/classList.js' );
      }

      // Load markdown parser if there are slides defined using markdown
      if( document.querySelector( '[data-markdown]' ) ) {
        scripts.push( 'lib/js/showdown.js' );
        scripts.push( 'lib/js/data-markdown.js' );
      }

      // If we're runnning the notes server we need to include some additional JS
      // TODO Is there a better way to determine if we're running the notes server?
      if( window.location.host === 'localhost:1947' ) {
        scripts.push( 'socket.io/socket.io.js' );
        scripts.push( 'plugin/speakernotes/client.js' );
      }

      scripts.push( 'libraries/reveal.js' );

      // Load the scripts and, when completed, initialize reveal.js
      head.js.apply( null, scripts.concat([function() {

        // Fires when a slide with data-state=customevent is activated
        Reveal.addEventListener( 'customevent', function() {
          console.log( '"customevent" has fired' );
        } );

        // Fires each time a new slide is activated
        Reveal.addEventListener( 'slidechanged', function( event ) {
          // event.previousSlide, event.currentSlide, event.indexh, event.indexv
          moveHearts();
        } );

        // Full list of configuration options available here:
        // https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
          controls: true,
          progress: true,
          history: true,

          theme: Reveal.getQueryHash().theme || 'default', // default/neon/beige
          transition: Reveal.getQueryHash().transition || 'default' // default/cube/page/concave/linear(2d)
        });

      }]));

    </script>
</body>
</html>